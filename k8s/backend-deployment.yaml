# ====================================================================================

# FILE: k8s/backend-deployment.yaml

# DESCRIPTION: Backend API deployment with security best practices

# ====================================================================================

apiVersion: apps/v1
kind: Deployment
metadata:
name: backend-api
namespace: secure-notes
labels:
app: backend-api
spec:
replicas: 2
selector:
matchLabels:
app: backend-api
template:
metadata:
labels:
app: backend-api
spec:
securityContext:
runAsNonRoot: true
runAsUser: 1000
fsGroup: 1000
containers:
- name: backend
image: secure-notes-backend:v1
imagePullPolicy: IfNotPresent
ports:
- containerPort: 5000
name: http
env:
- name: DB_HOST
valueFrom:
configMapKeyRef:
name: backend-config
key: DB_HOST
- name: DB_NAME
valueFrom:
configMapKeyRef:
name: backend-config
key: DB_NAME
- name: DB_USER
valueFrom:
configMapKeyRef:
name: backend-config
key: DB_USER
- name: DB_PASSWORD
valueFrom:
secretKeyRef:
name: postgres-secret
key: POSTGRES_PASSWORD
resources:
requests:
memory: “128Mi”
cpu: “100m”
limits:
memory: “256Mi”
cpu: “200m”
securityContext:
allowPrivilegeEscalation: false
readOnlyRootFilesystem: false
runAsNonRoot: true
capabilities:
drop:
- ALL
livenessProbe:
httpGet:
path: /health
port: 5000
initialDelaySeconds: 30
periodSeconds: 10
timeoutSeconds: 5
readinessProbe:
httpGet:
path: /ready
port: 5000
initialDelaySeconds: 10
periodSeconds: 5
timeoutSeconds: 3

-----
